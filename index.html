<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legal Statement Organizer</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; }
  .output { 
    background: #f0f0f0; 
    padding: 10px; 
    margin-top: 10px; 
    white-space: normal; /* allow text-indent to work */
  }
  .heading { 
    font-weight: bold; 
    font-style: italic; 
    margin-top: 1em; 
    margin-bottom: 0.3em;
  }
  .paragraph { 
    text-indent: 2em;  /* visible indentation */
    margin-bottom: 0.8em;
  }
</style>
</head>
<body>

<textarea id="text" rows="12" style="width:100%;">
SUMMARY OF EVENTS:
This is the first event.
It continues here.

KEY CONCERNS:
Concern one.
Concern two.

REQUEST / PURPOSE:
I request clarification.
</textarea>

<button onclick="showPreview()">Preview</button>
<button onclick="downloadPDF()">Download PDF</button>

<div id="preview" class="output"></div>

<script>
function showPreview() {
  const rawText = document.getElementById("text").value;
  const headings = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];

  // Split text into paragraphs by double newlines
  const paragraphs = rawText.split(/\n\n/).filter(p => p.trim() !== "");

  let html = "";

  paragraphs.forEach(paragraph => {
    const lines = paragraph.split("\n").filter(l => l.trim() !== "");
    lines.forEach(line => {
      if (headings.includes(line)) {
        html += `<div class="heading">${line}</div>`;
      } else {
        html += `<div class="paragraph">${line}</div>`;
      }
    });
  });

  // Limit preview to 500 characters (keep HTML structure intact)
  let previewText = html;
  if(previewText.length > 500){
    previewText = previewText.substring(0,500) + "<div>--- Preview Only ---</div>";
  }

  document.getElementById("preview").innerHTML = previewText;
  window.finalText = paragraphs;
}

function downloadPDF() {
  if (!window.finalText) { alert("Generate preview first"); return; }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 20;
  const headings = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];

  window.finalText.forEach(paragraph => {
    const lines = paragraph.split("\n").filter(l => l.trim() !== "");
    lines.forEach(line => {
      const isHeading = headings.includes(line);
      doc.setFont("helvetica", isHeading ? "bolditalic" : "normal");
      const x = isHeading ? 20 : 30; // indent for sentences under headings
      doc.text(line, x, y);
      y += 10;
    });
    y += 5; // extra space between paragraphs
  });

  doc.save("statement.pdf");
}
</script>

</body>
</html>
