<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legal Statement Organizer</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; }
  .output { background:#f0f0f0; padding:10px; margin-top:10px; white-space: pre-wrap; }
  .heading { font-weight: bold; font-style: italic; }
  .paragraph { text-indent: 2em; margin-bottom: 1em; }
</style>
</head>
<body>

<textarea id="text" rows="10" style="width:100%;">
SUMMARY OF EVENTS:
This is the first event.
It continues here.

KEY CONCERNS:
Concern one.
Concern two.

REQUEST / PURPOSE:
I request clarification.
</textarea>

<button onclick="showPreview()">Preview</button>
<button onclick="downloadPDF()">PDF</button>

<div id="preview" class="output"></div>

<script>
function showPreview() {
  const raw = document.getElementById("text").value;
  const sections = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];
  const paragraphs = raw.split(/\n\n/).filter(p => p.trim() !== "");
  let html = "";

  paragraphs.forEach(p => {
    const lines = p.split("\n").map(l => l.trim()).filter(l => l);
    lines.forEach((line, index) => {
      if(sections.includes(line)){
        html += `<span class="heading">${line}</span>\n`;
      } else {
        html += `<span class="paragraph">${line}</span>\n`;
      }
    });
    html += "\n";
  });

  // Limit preview to 500 characters
  document.getElementById("preview").innerHTML = html.substring(0, 500) + (html.length > 500 ? "\n--- Preview Only ---" : "");
  window.finalText = paragraphs;
}

function downloadPDF() {
  if(!window.finalText){ alert("Generate preview first"); return; }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 20;
  const sections = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];

  window.finalText.forEach(p => {
    const lines = p.split("\n").map(l => l.trim()).filter(l => l);
    lines.forEach(line => {
      const isHeading = sections.includes(line);
      doc.setFont("helvetica", isHeading ? "bolditalic" : "normal");
      const x = isHeading ? 20 : 30; // indent for paragraphs
      doc.text(line, x, y);
      y += 10;
    });
    y += 5;
  });

  doc.save("statement.pdf");
}
</script>

</body>
</html>
