<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Indented Sentences under Subtitles</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { font-family: Arial, sans-serif; }
.output {
  background: #f0f0f0;
  padding: 12px;
  margin-top: 10px;
  white-space: normal;
}
.subtitle {
  font-weight: bold;
  margin-top: 1em;
}
.content {
  padding-left: 2em; /* visible indentation */
  margin-bottom: 1em;
}
</style>
</head>
<body>

<textarea id="text" rows="10" style="width:100%;">
SUMMARY OF EVENTS:
This is the first event. It continues here.

KEY CONCERNS:
Concern one. Concern two.

REQUEST / PURPOSE:
I request clarification.
</textarea>

<br><br>
<button onclick="showPreview()">Preview</button>
<button onclick="downloadPDF()">PDF</button>

<div id="preview" class="output"></div>

<script>
const SECTIONS = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];
const MAX_CHARS = 500;
window.finalLines = [];

function escapeHtml(str) {
  return str.replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;").replaceAll("'", "&#039;");
}

function showPreview() {
  const raw = document.getElementById("text").value.trim();
  const lines = raw.split("\n");
  let html = "";
  let usedChars = 0;
  window.finalLines = [];
  let currentContent = "";

  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;

    if (SECTIONS.includes(line)) {
      // flush previous content
      if (currentContent) {
        if (usedChars < MAX_CHARS) {
          const chunk = currentContent.slice(0, MAX_CHARS - usedChars);
          html += `<div class="content">${escapeHtml(chunk)}</div>`;
          window.finalLines.push({ text: chunk, heading: false });
          usedChars += chunk.length;
        }
        currentContent = "";
      }
      html += `<div class="subtitle">${escapeHtml(line)}</div>`;
      window.finalLines.push({ text: line, heading: true });
    } else {
      currentContent += (currentContent ? " " : "") + line;
    }
  }

  // flush remaining content
  if (currentContent && usedChars < MAX_CHARS) {
    const chunk = currentContent.slice(0, MAX_CHARS - usedChars);
    html += `<div class="content">${escapeHtml(chunk)}</div>`;
    window.finalLines.push({ text: chunk, heading: false });
  }

  if (raw.length > usedChars) {
    html += `<em>— Preview limited to ${MAX_CHARS} characters —</em>`;
  }

  document.getElementById("preview").innerHTML = html;
}

function downloadPDF() {
  if (!window.finalLines || window.finalLines.length === 0) {
    alert("Generate preview first");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 20;

  window.finalLines.forEach(item => {
    // subtitles bold, content normal
    doc.setFont("helvetica", item.heading ? "bold" : "normal");
    const x = item.heading ? 20 : 35; // indent content
    const wrapped = doc.splitTextToSize(item.text, 170);
    wrapped.forEach(line => {
      if (y > 280) { doc.addPage(); y = 20; }
      doc.text(line, x, y);
      y += 8;
    });
    y += item.heading ? 6 : 4; // extra spacing after subtitles
  });

  doc.save("statement.pdf");
}
</script>

</body>
</html>
