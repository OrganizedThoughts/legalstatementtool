<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Legal Statement Organizer - Format Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', Arial, sans-serif; margin: 0; padding: 20px; background: #f0f9ff; color: #333; }
.container { max-width: 750px; margin:auto; background:white; padding:30px 25px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.1); }
h2 { color:#1f6feb; font-weight:600; text-align:center; margin-bottom:20px; }
label { font-weight:600; display:block; margin-bottom:5px; }
input, textarea, select { width:100%; padding:12px; margin-bottom:20px; border-radius:8px; border:1px solid #ccc; font-size:15px; }
button { padding:14px; width:100%; background:#1f6feb; color:white; border:none; font-size:16px; border-radius:8px; cursor:pointer; }
button:hover { background:#155bcf; }
.output { background:#f9f9f9; padding:15px; margin-top:20px; border-radius:8px; border:1px solid #e0e0e0; font-family: 'Inter', sans-serif; white-space: pre-wrap; }
.output p { text-indent: 1.5em; margin: 0 0 12px 0; }
.output strong { color: #1f6feb; }
</style>
</head>
<body>
<div class="container">
<h2>AI Legal Statement Organizer (Format Test)</h2>

<div>
<label>üìù Your Full Legal Name</label>
<input id="name">
<label>State (optional)</label>
<input id="state" placeholder="e.g., New York">
<label>Type of Matter</label>
<select id="matter">
  <option>Family Court</option>
  <option>Custody / Visitation</option>
  <option>Child Support</option>
  <option>Divorce</option>
  <option>Landlord / Tenant</option>
  <option>Civil Matter</option>
  <option>Other Legal Matter</option>
</select>
<label>Who is this statement for?</label>
<select id="recipient">
  <option>My Attorney</option>
  <option>The Court</option>
  <option>Both</option>
</select>
</div>

<div>
<label>Chronological Summary of Events (facts only)</label>
<textarea id="facts" rows="5"></textarea>
<label>Key Concerns or Issues</label>
<textarea id="concerns" rows="4"></textarea>
<label>What outcome or clarification are you requesting?</label>
<textarea id="request" rows="3"></textarea>
</div>

<button onclick="generate()">Generate AI Preview</button>
<button onclick="downloadPDF()">Download PDF</button>
<div id="preview" class="output"></div>

<script>
async function rewriteStatement(text) {
  const response = await fetch("/api/rewrite", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  });
  if (!response.ok) throw new Error("AI failed");
  const data = await response.json();
  return data.result;
}

// Format text for preview (HTML) and PDF
function formatText(text) {
  const sections = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];
  const lines = text.split("\n");
  let html = "";
  let pdfText = "";
  lines.forEach(line => {
    line = line.trim();
    if (!line) return;
    if (sections.includes(line)) {
      html += `<p><strong>${line}</strong></p>`;
      pdfText += line + "\n";
    } else {
      html += `<p>${line}</p>`;
      pdfText += "    " + line + "\n";
    }
  });
  return { html, pdfText };
}

async function generate() {
  const name = document.getElementById("name").value || "[Name]";
  const state = document.getElementById("state").value || "the applicable jurisdiction";
  const matter = document.getElementById("matter").value;
  const recipient = document.getElementById("recipient").value;
  const facts = document.getElementById("facts").value || "[Summary of events]";
  const concerns = document.getElementById("concerns").value || "[Key concerns]";
  const request = document.getElementById("request").value || "[Requested outcome]";

  const rawText = `
Name: ${name}
State: ${state}
Matter Type: ${matter}
Recipient: ${recipient}

SUMMARY OF EVENTS:
${facts}

KEY CONCERNS:
${concerns}

REQUEST / PURPOSE:
${request}
`;

  try {
    const polishedText = await rewriteStatement(rawText);
    const { html, pdfText } = formatText(polishedText + `

Respectfully submitted,
${name}
_________________________
Date: ${new Date().toLocaleDateString()}`);

    window.finalText = pdfText;
    document.getElementById("preview").innerHTML = html.substring(0, 500) + (html.length > 500 ? "<p>--- Preview Only ---</p>" : "");
  } catch(err) { alert(err.message); }
}

function downloadPDF() {
  if (!window.finalText) return alert("Please generate the preview first!");
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "letter" });
  const margin = 40;
  let y = margin;

  doc.setFontSize(16);
  doc.setFont(undefined, "bold");
  doc.text("STATEMENT FOR LEGAL COMMUNICATION", margin, y);
  y += 30;

  doc.setFontSize(12);
  const lines = window.finalText.split("\n");
  const headings = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];
  lines.forEach(line => {
    const trimmed = line.trim();
    if (!trimmed) return y += 12;
    const isHeading = headings.some(h => trimmed.includes(h));
    doc.setFont(undefined, isHeading ? "bold" : "normal");
    const splitLines = doc.splitTextToSize(trimmed, 520);
    splitLines.forEach(l => { doc.text(l, margin, y); y += 18; });
  });
  doc.save("legal-statement.pdf");
}
</script>
</div>
</body>
</html>
