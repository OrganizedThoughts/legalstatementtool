<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legal Statement Organizer</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial, sans-serif; }

.output {
background: #f0f0f0;
padding: 12px;
margin-top: 10px;
white-space: normal;
}

.heading {
font-weight: bold;
font-style: italic;
display: block;
margin-top: 1em;
}

.sentence {
text-indent: 3em; /* generous indentation */
margin-bottom: 0.75em;
display: block;
}
</style>
</head>

<body>

<textarea id="text" rows="10" style="width:100%;">
SUMMARY OF EVENTS:
This is the first event. It continues here.

KEY CONCERNS:
Concern one. Concern two.

REQUEST / PURPOSE:
I request clarification.
</textarea>

<br><br>

<button onclick="showPreview()">Preview</button>
<button onclick="downloadPDF()">PDF</button>

<div id="preview" class="output"></div>

<script>
const SECTIONS = [
"SUMMARY OF EVENTS:",
"KEY CONCERNS:",
"REQUEST / PURPOSE:"
];

function splitSentences(text) {
return text
.match(/[^.!?]+[.!?]*/g)
?.map(s => s.trim())
.filter(Boolean) || [];
}

function showPreview() {
const raw = document.getElementById("text").value.trim();
const lines = raw.split("\n").map(l => l.trim()).filter(Boolean);

let html = "";
let plainTextCount = 0;
const MAX_CHARS = 500;

window.finalLines = [];

for (let line of lines) {
if (SECTIONS.includes(line)) {
html += `<span class="heading">${line}</span>`;
plainTextCount += line.length;
window.finalLines.push({ text: line, heading: true });
} else {
const sentences = splitSentences(line);
sentences.forEach(sentence => {
if (plainTextCount < MAX_CHARS) {
html += `<span class="sentence">${sentence}</span>`;
}
plainTextCount += sentence.length;
window.finalLines.push({ text: sentence, heading: false });
});
}
}

if (plainTextCount > MAX_CHARS) {
html += `<em>— Preview limited to 500 characters —</em>`;
}

document.getElementById("preview").innerHTML = html;
}

function downloadPDF() {
if (!window.finalLines) {
alert("Generate preview first");
return;
}

const { jsPDF } = window.jspdf;
const doc = new jsPDF();
let y = 20;

window.finalLines.forEach(item => {
doc.setFont("helvetica", item.heading ? "bolditalic" : "normal");

const x = item.heading ? 20 : 35; // strong paragraph indentation
const wrapped = doc.splitTextToSize(item.text, 170);

wrapped.forEach(line => {
if (y > 280) {
doc.addPage();
y = 20;
}
doc.text(line, x, y);
y += 8;
});

y += item.heading ? 6 : 4;
});

doc.save("statement.pdf");
}
</script>

</body>
</html>
