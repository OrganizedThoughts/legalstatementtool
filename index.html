<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legal Statement Organizer</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; }
  .output { 
    background: #f0f0f0; 
    padding: 10px; 
    margin-top: 10px; 
    white-space: pre-wrap; /* preserve line breaks */
    font-family: monospace;
  }
  .heading { 
    font-weight: bold; 
    font-style: italic; 
    display: block; 
    margin-top: 1em;
    margin-bottom: 0.3em;
  }
  .paragraph { 
    display: block;
    margin-bottom: 1em;
  }
</style>
</head>
<body>

<textarea id="text" rows="12" style="width:100%;">
SUMMARY OF EVENTS:
This is the first event.
It continues here.

KEY CONCERNS:
Concern one.
Concern two.

REQUEST / PURPOSE:
I request clarification.
</textarea>

<button onclick="showPreview()">Preview</button>
<button onclick="downloadPDF()">Download PDF</button>

<div id="preview" class="output"></div>

<script>
function showPreview() {
  const rawText = document.getElementById("text").value;
  const headings = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];
  
  const paragraphs = rawText.split(/\n\n/).filter(p => p.trim() !== "");
  let html = "";

  paragraphs.forEach(paragraph => {
    const lines = paragraph.split("\n").filter(l => l.trim() !== "");
    lines.forEach((line, index) => {
      if (headings.includes(line)) {
        html += `<span class="heading">${line}</span>\n`;
      } else {
        // Indent by 4 spaces for each paragraph line
        html += `<span class="paragraph">&nbsp;&nbsp;&nbsp;&nbsp;${line}</span>\n`;
      }
    });
  });

  // Limit preview to 500 characters
  let previewText = html;
  if (previewText.length > 500) {
    previewText = previewText.substring(0, 500) + "\n--- Preview Only ---";
  }

  document.getElementById("preview").innerHTML = previewText;
  window.finalText = paragraphs;
}

function downloadPDF() {
  if (!window.finalText) { alert("Generate preview first"); return; }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 20;
  const headings = ["SUMMARY OF EVENTS:", "KEY CONCERNS:", "REQUEST / PURPOSE:"];

  window.finalText.forEach(paragraph => {
    const lines = paragraph.split("\n").filter(l => l.trim() !== "");
    lines.forEach(line => {
      const isHeading = headings.includes(line);
      doc.setFont("helvetica", isHeading ? "bolditalic" : "normal");
      const x = isHeading ? 20 : 30; // indent normal lines
      doc.text(line, x, y);
      y += 10; // line spacing
    });
    y += 5; // extra spacing between paragraphs
  });

  doc.save("statement.pdf");
}
</script>

</body>
</html>
