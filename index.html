<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Legal Statement Generator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://gumroad.com/js/gumroad.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
  font-family: 'Inter', Arial, sans-serif; 
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
}
.container {
  max-width: 800px;
  margin: 0 auto;
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  padding: 40px;
}
h1 {
  color: #667eea;
  text-align: center;
  margin-bottom: 30px;
  font-size: 28px;
}
.form-group {
  margin-bottom: 20px;
}
label {
  display: block;
  font-weight: 600;
  color: #333;
  margin-bottom: 8px;
  font-size: 14px;
}
input, textarea, select {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 15px;
  font-family: 'Inter', Arial, sans-serif;
  transition: border-color 0.3s;
}
input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: #667eea;
}
textarea {
  resize: vertical;
  min-height: 100px;
}
.btn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  margin-top: 10px;
}
.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}
.btn:active {
  transform: translateY(0);
}
.preview-box {
  background: #f8f9fa;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  padding: 25px;
  margin-top: 30px;
  display: none;
}
.preview-box.active {
  display: block;
}
.preview-title {
  font-weight: bold;
  font-size: 13px;
  color: #666;
  margin-bottom: 15px;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.preview-content {
  line-height: 1.8;
}
.preview-content .section-title {
  font-weight: bold;
  color: #333;
  margin-top: 15px;
  margin-bottom: 8px;
  font-size: 15px;
}
.preview-content .section-text {
  padding-left: 30px;
  color: #555;
  margin-bottom: 12px;
}
.preview-limit {
  margin-top: 20px;
  padding-top: 20px;
  border-top: 2px solid #e0e0e0;
  font-style: italic;
  color: #999;
  text-align: center;
}
.paywall {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: white;
  padding: 30px;
  border-radius: 8px;
  margin-top: 20px;
  text-align: center;
}
.paywall h3 {
  margin-bottom: 10px;
  font-size: 24px;
}
.paywall .price {
  font-size: 48px;
  font-weight: bold;
  margin: 15px 0;
}
.paywall p {
  margin-bottom: 20px;
  font-size: 16px;
}
.gumroad-btn {
  display: inline-block;
  background: white;
  color: #f5576c;
  padding: 16px 40px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  font-size: 18px;
  transition: transform 0.2s, box-shadow 0.2s;
  border: none;
  cursor: pointer;
}
.gumroad-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}
.payment-note {
  font-size: 13px;
  margin-top: 20px;
  opacity: 0.9;
  line-height: 1.5;
}
.loading {
  text-align: center;
  color: #667eea;
  margin-top: 20px;
  display: none;
}
.loading.active {
  display: block;
}
.download-section {
  background: #e8f5e9;
  border: 2px solid #4caf50;
  border-radius: 8px;
  padding: 25px;
  margin-top: 20px;
  text-align: center;
  display: none;
}
.download-section.active {
  display: block;
}
.download-section h3 {
  color: #2e7d32;
  margin-bottom: 15px;
}
.download-btn {
  background: #4caf50;
  color: white;
  padding: 16px 40px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}
.download-btn:hover {
  background: #45a049;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
}
</style>
</head>
<body>
<div class="container">
  <h1>üìã AI Legal Statement Generator</h1>
  
  <form id="statementForm" onsubmit="return false;">
    <div class="form-group">
      <label>üìù Your Full Legal Name</label>
      <input type="text" id="name" placeholder="Enter your full name">
    </div>
    
    <div class="form-group">
      <label>üìç State (Optional)</label>
      <input type="text" id="state" placeholder="e.g., New York">
    </div>
    
    <div class="form-group">
      <label>‚öñÔ∏è Type of Matter</label>
      <select id="matter">
        <option>Family Court</option>
        <option>Custody / Visitation</option>
        <option>Child Support</option>
        <option>Divorce</option>
        <option>Landlord / Tenant</option>
        <option>Civil Matter</option>
        <option>Other Legal Matter</option>
      </select>
    </div>
    
    <div class="form-group">
      <label>üë§ Who is this statement for?</label>
      <select id="recipient">
        <option>My Attorney</option>
        <option>The Court</option>
        <option>Both</option>
      </select>
    </div>
    
    <div class="form-group">
      <label>üìÖ Chronological Summary of Events (Facts Only)</label>
      <textarea id="facts" rows="5" placeholder="Describe the events in chronological order..."></textarea>
    </div>
    
    <div class="form-group">
      <label>‚ö†Ô∏è Key Concerns or Issues</label>
      <textarea id="concerns" rows="4" placeholder="What are your main concerns?"></textarea>
    </div>
    
    <div class="form-group">
      <label>üéØ What outcome or clarification are you requesting?</label>
      <textarea id="request" rows="3" placeholder="What do you want to achieve?"></textarea>
    </div>
    
    <button type="button" class="btn" onclick="generateStatement()">‚ú® Generate AI Statement</button>
  </form>
  
  <div class="loading" id="loading">
    <p>ü§ñ AI is polishing your statement...</p>
  </div>
  
  <div class="preview-box" id="previewBox">
    <div class="preview-title">üìÑ Preview (Limited to 500 Characters)</div>
    <div class="preview-content" id="previewContent"></div>
  </div>
  
  <div class="paywall" id="paywall" style="display:none;">
    <h3>üîì Unlock Your Full Statement</h3>
    <div class="price">$10</div>
    <p>Get your complete AI-polished PDF with professional formatting</p>
    
    <a class="gumroad-button gumroad-btn" href="https://YOUR_USERNAME.gumroad.com/l/YOUR_PRODUCT_LINK" target="_blank">
      üí≥ Purchase PDF Access
    </a>
    
    <p class="payment-note">
      ‚úÖ Secure checkout via Gumroad<br>
      ‚úÖ Accepts PayPal, Credit Cards, Apple Pay & more<br>
      ‚úÖ Instant download after payment
    </p>
  </div>
  
  <div class="download-section" id="downloadSection">
    <h3>‚úÖ Payment Confirmed!</h3>
    <p style="color: #2e7d32; margin-bottom: 20px;">Your purchase is complete. Download your professional PDF below:</p>
    <button class="download-btn" onclick="downloadFullPDF()">üì• Download Your PDF</button>
  </div>
</div>

<script>
let fullStatement = "";
let statementData = {};

// Check if user came back from Gumroad purchase
window.addEventListener('load', function() {
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('purchased') === 'true') {
    // User completed purchase, show download section
    document.getElementById('downloadSection').classList.add('active');
    // Try to retrieve saved statement from localStorage
    const savedStatement = localStorage.getItem('pendingStatement');
    if (savedStatement) {
      fullStatement = savedStatement;
    }
  }
});

async function generateStatement() {
  const name = document.getElementById("name").value.trim() || "[Your Name]";
  const state = document.getElementById("state").value.trim() || "the applicable jurisdiction";
  const matter = document.getElementById("matter").value;
  const recipient = document.getElementById("recipient").value;
  const facts = document.getElementById("facts").value.trim() || "[Summary of events]";
  const concerns = document.getElementById("concerns").value.trim() || "[Key concerns]";
  const request = document.getElementById("request").value.trim() || "[Requested outcome]";
  
  statementData = { name, state, matter, recipient, facts, concerns, request };
  
  const rawStatement = `
Name: ${name}
State: ${state}
Matter Type: ${matter}
Recipient: ${recipient}

SUMMARY OF EVENTS:
${facts}

KEY CONCERNS:
${concerns}

REQUEST / PURPOSE:
${request}
`;

  document.getElementById("loading").classList.add("active");
  document.getElementById("previewBox").classList.remove("active");
  document.getElementById("paywall").style.display = "none";
  
  try {
    const response = await fetch("/api/rewrite", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: rawStatement })
    });
    
    if (!response.ok) {
      throw new Error("AI service unavailable");
    }
    
    const data = await response.json();
    let polishedText = data.result;
    
    fullStatement = polishedText + `\n\nRespectfully submitted,\n${name}\n_________________________\nDate: ${new Date().toLocaleDateString()}`;
    
    // Save statement for after payment
    localStorage.setItem('pendingStatement', fullStatement);
    
    displayPreview(fullStatement);
    document.getElementById("paywall").style.display = "block";
    
  } catch (error) {
    alert("Failed to generate statement. Please try again.");
    console.error(error);
  } finally {
    document.getElementById("loading").classList.remove("active");
  }
}

function displayPreview(text) {
  const lines = text.split('\n');
  let html = '';
  let charCount = 0;
  const CHAR_LIMIT = 500;
  
  for (let line of lines) {
    line = line.trim();
    // Remove any ** markdown formatting
    line = line.replace(/\*\*/g, '');
    if (!line) continue;
    
    const isHeading = (line.includes(':') && line.length < 50 && line.toUpperCase() === line) ||
                      line.includes('SUMMARY') || 
                      line.includes('CONCERNS') || 
                      line.includes('REQUEST') ||
                      line.includes('PURPOSE');
    
    if (isHeading) {
      html += `<div class="section-title">${escapeHtml(line)}</div>`;
    } else {
      const remaining = CHAR_LIMIT - charCount;
      if (remaining <= 0) break;
      
      let displayText = line;
      if (line.length > remaining) {
        displayText = line.substring(0, remaining) + '...';
      }
      
      html += `<div class="section-text">${escapeHtml(displayText)}</div>`;
      charCount += displayText.length;
      
      if (displayText.endsWith('...')) break;
    }
  }
  
  if (charCount >= CHAR_LIMIT) {
    html += '<div class="preview-limit">Preview limited to 500 characters. Purchase to download full statement.</div>';
  }
  
  document.getElementById("previewContent").innerHTML = html;
  document.getElementById("previewBox").classList.add("active");
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function downloadFullPDF() {
  if (!fullStatement) {
    alert("Please generate a statement first");
    return;
  }
  
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  const margin = 20;
  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const maxWidth = pageWidth - (margin * 2);
  const indent = 15;
  
  let y = margin;
  
  doc.setFont("helvetica", "bold");
  doc.setFontSize(16);
  doc.text("LEGAL STATEMENT", pageWidth / 2, y, { align: "center" });
  y += 15;
  
  doc.setFontSize(11);
  doc.setFont("helvetica", "normal");
  
  // Clean up any markdown formatting (** for bold)
  const cleanedStatement = fullStatement.replace(/\*\*/g, '');
  const lines = cleanedStatement.split('\n');
  
  for (let line of lines) {
    line = line.trim();
    if (!line) {
      y += 6;
      continue;
    }
    
    const isHeading = (line.includes(':') && line.length < 50 && line.toUpperCase() === line) ||
                      line.includes('SUMMARY') || 
                      line.includes('CONCERNS') || 
                      line.includes('REQUEST') ||
                      line.includes('PURPOSE') ||
                      line.includes('Respectfully');
    
    if (y > pageHeight - margin - 20) {
      doc.addPage();
      y = margin;
    }
    
    if (isHeading) {
      y += 4;
      doc.setFont("helvetica", "bold");
      const wrappedHeading = doc.splitTextToSize(line, maxWidth);
      doc.text(wrappedHeading, margin, y);
      y += wrappedHeading.length * 7;
      doc.setFont("helvetica", "normal");
      y += 3;
    } else {
      const wrappedText = doc.splitTextToSize(line, maxWidth - indent);
      for (let wrappedLine of wrappedText) {
        if (y > pageHeight - margin - 20) {
          doc.addPage();
          y = margin;
        }
        doc.text(wrappedLine, margin + indent, y);
        y += 7;
      }
      y += 2;
    }
  }
  
  doc.save("legal-statement.pdf");
  
  // Clear saved statement after download
  localStorage.removeItem('pendingStatement');
}
</script>
</body>
</html>
